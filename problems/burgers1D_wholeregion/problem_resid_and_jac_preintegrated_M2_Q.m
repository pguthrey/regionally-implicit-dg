function [Jac_east_cell_temp,Jac_west_cell_temp, Jac_east_other_temp,Jac_west_other_temp, Jac_trunc_east_temp,Jac_trunc_west_temp,Jac_cell,trunceast_temp,truncwest_temp,fluxeast_temp,fluxwest_temp,residual_cell,maxspeedF] = problem_resid_and_jac_preintegrated_M2_Q(qstar,qeast,qwest,qpast,data,cellcenter) 
nuv1 = data.nuv1us4= qstar(4);
us3= qstar(3);
us2= qstar(2);
us1= qstar(1);
uw4= qwest(4);
uw3= qwest(3);
uw2= qwest(2);
uw1= qwest(1);
ue4= qeast(4);
ue3= qeast(3);
ue2= qeast(2);
ue1= qeast(1);
if qstar(1) > qeast(1) 
   flux_east_temp_pre(4,1) = 1.732050807568877*ue1*ue3 - 3.0*ue1*ue4 - 3.0*ue2*ue3 + 5.196152422706632*ue2*ue4 - 1.732050807568877*ue1*us3 - 1.732050807568877*ue3*us1 - 3.0*ue1*us4 + 3.0*ue2*us3 - 3.0*ue3*us2 + 3.0*ue4*us1 + 5.196152422706632*ue2*us4 + 5.196152422706632*ue4*us2 + 5.196152422706632*us1*us3 + 9.0*us1*us4 + 9.0*us2*us3 + 15.5884572681199*us2*us4;
   flux_east_temp_pre(3,1) = ue1*ue3 - 1.732050807568877*ue1*ue4 - 1.732050807568877*ue2*ue3 + 3.0*ue2*ue4 - 1.0*ue1*us3 - 1.0*ue3*us1 - 1.732050807568877*ue1*us4 + 1.732050807568877*ue2*us3 - 1.732050807568877*ue3*us2 + 1.732050807568877*ue4*us1 + 3.0*ue2*us4 + 3.0*ue4*us2 + 3.0*us1*us3 + 5.196152422706632*us1*us4 + 5.196152422706632*us2*us3 + 9.0*us2*us4;
   flux_east_temp_pre(2,1) = 3.0*ue2*us1 - 3.0*ue3*ue4 - 1.732050807568877*ue1*us1 - 3.0*ue1*us2 - 3.0*ue1*ue2 + 5.196152422706632*ue2*us2 - 1.732050807568877*ue3*us3 - 3.0*ue3*us4 + 3.0*ue4*us3 + 5.196152422706632*ue4*us4 + 9.0*us1*us2 + 9.0*us3*us4 + 0.8660254037844386*ue1^2 + 2.598076211353316*ue2^2 + 0.8660254037844386*ue3^2 + 2.598076211353316*ue4^2 + 2.598076211353316*us1^2 + 7.794228634059948*us2^2 + 2.598076211353316*us3^2 + 7.794228634059948*us4^2;
   flux_east_temp_pre(1,1) = 1.732050807568877*ue2*us1 - 1.732050807568877*ue3*ue4 - 1.0*ue1*us1 - 1.732050807568877*ue1*us2 - 1.732050807568877*ue1*ue2 + 3.0*ue2*us2 - 1.0*ue3*us3 - 1.732050807568877*ue3*us4 + 1.732050807568877*ue4*us3 + 3.0*ue4*us4 + 5.196152422706632*us1*us2 + 5.196152422706632*us3*us4 + 0.5*ue1^2 + 1.5*ue2^2 + 0.5*ue3^2 + 1.5*ue4^2 + 1.5*us1^2 + 4.5*us2^2 + 1.5*us3^2 + 4.5*us4^2;
   flux_east_temp =  nuv1*flux_east_temp_pre;
   Jac_east_cell_temp_pre(4,4) = 5.196152422706632*ue2 - 3.0*ue1 + 9.0*us1 + 15.5884572681199*us2;
   Jac_east_cell_temp_pre(4,3) = 3.0*ue2 - 1.732050807568877*ue1 + 5.196152422706632*us1 + 9.0*us2;
   Jac_east_cell_temp_pre(4,2) = 5.196152422706632*ue4 - 3.0*ue3 + 9.0*us3 + 15.5884572681199*us4;
   Jac_east_cell_temp_pre(4,1) = 3.0*ue4 - 1.732050807568877*ue3 + 5.196152422706632*us3 + 9.0*us4;
   Jac_east_cell_temp_pre(3,4) = 3.0*ue2 - 1.732050807568877*ue1 + 5.196152422706632*us1 + 9.0*us2;
   Jac_east_cell_temp_pre(3,3) = 1.732050807568877*ue2 - 1.0*ue1 + 3.0*us1 + 5.196152422706632*us2;
   Jac_east_cell_temp_pre(3,2) = 3.0*ue4 - 1.732050807568877*ue3 + 5.196152422706632*us3 + 9.0*us4;
   Jac_east_cell_temp_pre(3,1) = 1.732050807568877*ue4 - 1.0*ue3 + 3.0*us3 + 5.196152422706632*us4;
   Jac_east_cell_temp_pre(2,4) = 5.196152422706632*ue4 - 3.0*ue3 + 9.0*us3 + 15.5884572681199*us4;
   Jac_east_cell_temp_pre(2,3) = 3.0*ue4 - 1.732050807568877*ue3 + 5.196152422706632*us3 + 9.0*us4;
   Jac_east_cell_temp_pre(2,2) = 5.196152422706632*ue2 - 3.0*ue1 + 9.0*us1 + 15.5884572681199*us2;
   Jac_east_cell_temp_pre(2,1) = 3.0*ue2 - 1.732050807568877*ue1 + 5.196152422706632*us1 + 9.0*us2;
   Jac_east_cell_temp_pre(1,4) = 3.0*ue4 - 1.732050807568877*ue3 + 5.196152422706632*us3 + 9.0*us4;
   Jac_east_cell_temp_pre(1,3) = 1.732050807568877*ue4 - 1.0*ue3 + 3.0*us3 + 5.196152422706632*us4;
   Jac_east_cell_temp_pre(1,2) = 3.0*ue2 - 1.732050807568877*ue1 + 5.196152422706632*us1 + 9.0*us2;
   Jac_east_cell_temp_pre(1,1) = 1.732050807568877*ue2 - 1.0*ue1 + 3.0*us1 + 5.196152422706632*us2;
   Jac_east_cell_temp = nuv1*Jac_east_cell_temp_pre;
   Jac_east_other_temp_pre(4,4) = 5.196152422706632*ue2 - 3.0*ue1 + 3.0*us1 + 5.196152422706632*us2;
   Jac_east_other_temp_pre(4,3) = 1.732050807568877*ue1 - 3.0*ue2 - 1.732050807568877*us1 - 3.0*us2;
   Jac_east_other_temp_pre(4,2) = 5.196152422706632*ue4 - 3.0*ue3 + 3.0*us3 + 5.196152422706632*us4;
   Jac_east_other_temp_pre(4,1) = 1.732050807568877*ue3 - 3.0*ue4 - 1.732050807568877*us3 - 3.0*us4;
   Jac_east_other_temp_pre(3,4) = 3.0*ue2 - 1.732050807568877*ue1 + 1.732050807568877*us1 + 3.0*us2;
   Jac_east_other_temp_pre(3,3) = ue1 - 1.732050807568877*ue2 - 1.0*us1 - 1.732050807568877*us2;
   Jac_east_other_temp_pre(3,2) = 3.0*ue4 - 1.732050807568877*ue3 + 1.732050807568877*us3 + 3.0*us4;
   Jac_east_other_temp_pre(3,1) = ue3 - 1.732050807568877*ue4 - 1.0*us3 - 1.732050807568877*us4;
   Jac_east_other_temp_pre(2,4) = 5.196152422706632*ue4 - 3.0*ue3 + 3.0*us3 + 5.196152422706632*us4;
   Jac_east_other_temp_pre(2,3) = 1.732050807568877*ue3 - 3.0*ue4 - 1.732050807568877*us3 - 3.0*us4;
   Jac_east_other_temp_pre(2,2) = 5.196152422706632*ue2 - 3.0*ue1 + 3.0*us1 + 5.196152422706632*us2;
   Jac_east_other_temp_pre(2,1) = 1.732050807568877*ue1 - 3.0*ue2 - 1.732050807568877*us1 - 3.0*us2;
   Jac_east_other_temp_pre(1,4) = 3.0*ue4 - 1.732050807568877*ue3 + 1.732050807568877*us3 + 3.0*us4;
   Jac_east_other_temp_pre(1,3) = ue3 - 1.732050807568877*ue4 - 1.0*us3 - 1.732050807568877*us4;
   Jac_east_other_temp_pre(1,2) = 3.0*ue2 - 1.732050807568877*ue1 + 1.732050807568877*us1 + 3.0*us2;
   Jac_east_other_temp_pre(1,1) = ue1 - 1.732050807568877*ue2 - 1.0*us1 - 1.732050807568877*us2;
   Jac_east_other_temp = nuv1*Jac_east_other_temp_pre;
else 
   flux_east_temp_pre(4,1) = 3.0*ue1*ue4 - 1.732050807568877*ue1*ue3 + 3.0*ue2*ue3 - 5.196152422706632*ue2*ue4 + 1.732050807568877*ue1*us3 + 1.732050807568877*ue3*us1 + 3.0*ue1*us4 - 3.0*ue2*us3 + 3.0*ue3*us2 - 3.0*ue4*us1 - 5.196152422706632*ue2*us4 - 5.196152422706632*ue4*us2 + 1.732050807568877*us1*us3 + 3.0*us1*us4 + 3.0*us2*us3 + 5.196152422706632*us2*us4;
   flux_east_temp_pre(3,1) = 1.732050807568877*ue1*ue4 - 1.0*ue1*ue3 + 1.732050807568877*ue2*ue3 - 3.0*ue2*ue4 + ue1*us3 + ue3*us1 + 1.732050807568877*ue1*us4 - 1.732050807568877*ue2*us3 + 1.732050807568877*ue3*us2 - 1.732050807568877*ue4*us1 - 3.0*ue2*us4 - 3.0*ue4*us2 + us1*us3 + 1.732050807568877*us1*us4 + 1.732050807568877*us2*us3 + 3.0*us2*us4;
   flux_east_temp_pre(2,1) = 3.0*ue1*ue2 + 3.0*ue3*ue4 + 1.732050807568877*ue1*us1 + 3.0*ue1*us2 - 3.0*ue2*us1 - 5.196152422706632*ue2*us2 + 1.732050807568877*ue3*us3 + 3.0*ue3*us4 - 3.0*ue4*us3 - 5.196152422706632*ue4*us4 + 3.0*us1*us2 + 3.0*us3*us4 - 0.8660254037844386*ue1^2 - 2.598076211353316*ue2^2 - 0.8660254037844386*ue3^2 - 2.598076211353316*ue4^2 + 0.8660254037844386*us1^2 + 2.598076211353316*us2^2 + 0.8660254037844386*us3^2 + 2.598076211353316*us4^2;
   flux_east_temp_pre(1,1) = 1.732050807568877*ue1*ue2 + 1.732050807568877*ue3*ue4 + ue1*us1 + 1.732050807568877*ue1*us2 - 1.732050807568877*ue2*us1 - 3.0*ue2*us2 + ue3*us3 + 1.732050807568877*ue3*us4 - 1.732050807568877*ue4*us3 - 3.0*ue4*us4 + 1.732050807568877*us1*us2 + 1.732050807568877*us3*us4 - 0.5*ue1^2 - 1.5*ue2^2 - 0.5*ue3^2 - 1.5*ue4^2 + 0.5*us1^2 + 1.5*us2^2 + 0.5*us3^2 + 1.5*us4^2;
   flux_east_temp =  nuv1*flux_east_temp_pre;
   Jac_east_cell_temp_pre(4,4) = 3.0*ue1 - 5.196152422706632*ue2 + 3.0*us1 + 5.196152422706632*us2;
   Jac_east_cell_temp_pre(4,3) = 1.732050807568877*ue1 - 3.0*ue2 + 1.732050807568877*us1 + 3.0*us2;
   Jac_east_cell_temp_pre(4,2) = 3.0*ue3 - 5.196152422706632*ue4 + 3.0*us3 + 5.196152422706632*us4;
   Jac_east_cell_temp_pre(4,1) = 1.732050807568877*ue3 - 3.0*ue4 + 1.732050807568877*us3 + 3.0*us4;
   Jac_east_cell_temp_pre(3,4) = 1.732050807568877*ue1 - 3.0*ue2 + 1.732050807568877*us1 + 3.0*us2;
   Jac_east_cell_temp_pre(3,3) = ue1 - 1.732050807568877*ue2 + us1 + 1.732050807568877*us2;
   Jac_east_cell_temp_pre(3,2) = 1.732050807568877*ue3 - 3.0*ue4 + 1.732050807568877*us3 + 3.0*us4;
   Jac_east_cell_temp_pre(3,1) = ue3 - 1.732050807568877*ue4 + us3 + 1.732050807568877*us4;
   Jac_east_cell_temp_pre(2,4) = 3.0*ue3 - 5.196152422706632*ue4 + 3.0*us3 + 5.196152422706632*us4;
   Jac_east_cell_temp_pre(2,3) = 1.732050807568877*ue3 - 3.0*ue4 + 1.732050807568877*us3 + 3.0*us4;
   Jac_east_cell_temp_pre(2,2) = 3.0*ue1 - 5.196152422706632*ue2 + 3.0*us1 + 5.196152422706632*us2;
   Jac_east_cell_temp_pre(2,1) = 1.732050807568877*ue1 - 3.0*ue2 + 1.732050807568877*us1 + 3.0*us2;
   Jac_east_cell_temp_pre(1,4) = 1.732050807568877*ue3 - 3.0*ue4 + 1.732050807568877*us3 + 3.0*us4;
   Jac_east_cell_temp_pre(1,3) = ue3 - 1.732050807568877*ue4 + us3 + 1.732050807568877*us4;
   Jac_east_cell_temp_pre(1,2) = 1.732050807568877*ue1 - 3.0*ue2 + 1.732050807568877*us1 + 3.0*us2;
   Jac_east_cell_temp_pre(1,1) = ue1 - 1.732050807568877*ue2 + us1 + 1.732050807568877*us2;
   Jac_east_cell_temp = + nuv1*Jac_east_cell_temp_pre;
   Jac_east_other_temp_pre(4,4) = 3.0*ue1 - 5.196152422706632*ue2 - 3.0*us1 - 5.196152422706632*us2;
   Jac_east_other_temp_pre(4,3) = 3.0*ue2 - 1.732050807568877*ue1 + 1.732050807568877*us1 + 3.0*us2;
   Jac_east_other_temp_pre(4,2) = 3.0*ue3 - 5.196152422706632*ue4 - 3.0*us3 - 5.196152422706632*us4;
   Jac_east_other_temp_pre(4,1) = 3.0*ue4 - 1.732050807568877*ue3 + 1.732050807568877*us3 + 3.0*us4;
   Jac_east_other_temp_pre(3,4) = 1.732050807568877*ue1 - 3.0*ue2 - 1.732050807568877*us1 - 3.0*us2;
   Jac_east_other_temp_pre(3,3) = 1.732050807568877*ue2 - 1.0*ue1 + us1 + 1.732050807568877*us2;
   Jac_east_other_temp_pre(3,2) = 1.732050807568877*ue3 - 3.0*ue4 - 1.732050807568877*us3 - 3.0*us4;
   Jac_east_other_temp_pre(3,1) = 1.732050807568877*ue4 - 1.0*ue3 + us3 + 1.732050807568877*us4;
   Jac_east_other_temp_pre(2,4) = 3.0*ue3 - 5.196152422706632*ue4 - 3.0*us3 - 5.196152422706632*us4;
   Jac_east_other_temp_pre(2,3) = 3.0*ue4 - 1.732050807568877*ue3 + 1.732050807568877*us3 + 3.0*us4;
   Jac_east_other_temp_pre(2,2) = 3.0*ue1 - 5.196152422706632*ue2 - 3.0*us1 - 5.196152422706632*us2;
   Jac_east_other_temp_pre(2,1) = 3.0*ue2 - 1.732050807568877*ue1 + 1.732050807568877*us1 + 3.0*us2;
   Jac_east_other_temp_pre(1,4) = 1.732050807568877*ue3 - 3.0*ue4 - 1.732050807568877*us3 - 3.0*us4;
   Jac_east_other_temp_pre(1,3) = 1.732050807568877*ue4 - 1.0*ue3 + us3 + 1.732050807568877*us4;
   Jac_east_other_temp_pre(1,2) = 1.732050807568877*ue1 - 3.0*ue2 - 1.732050807568877*us1 - 3.0*us2;
   Jac_east_other_temp_pre(1,1) = 1.732050807568877*ue2 - 1.0*ue1 + us1 + 1.732050807568877*us2;
   Jac_east_other_temp = nuv1*Jac_east_other_temp_pre;
end
if qstar(1) > qwest(1) 
   flux_west_temp_pre(4,1) = 5.196152422706632*ue2*ue4 - 3.0*ue1*ue4 - 3.0*ue2*ue3 - 5.196152422706632*ue1*ue3 + 1.732050807568877*ue1*us3 + 1.732050807568877*ue3*us1 - 3.0*ue1*us4 - 3.0*ue2*us3 - 3.0*ue3*us2 - 3.0*ue4*us1 + 5.196152422706632*ue2*us4 + 5.196152422706632*ue4*us2 - 1.732050807568877*us1*us3 + 3.0*us1*us4 + 3.0*us2*us3 - 5.196152422706632*us2*us4;
   flux_west_temp_pre(3,1) = 3.0*ue1*ue3 + 1.732050807568877*ue1*ue4 + 1.732050807568877*ue2*ue3 - 3.0*ue2*ue4 - 1.0*ue1*us3 - 1.0*ue3*us1 + 1.732050807568877*ue1*us4 + 1.732050807568877*ue2*us3 + 1.732050807568877*ue3*us2 + 1.732050807568877*ue4*us1 - 3.0*ue2*us4 - 3.0*ue4*us2 + us1*us3 - 1.732050807568877*us1*us4 - 1.732050807568877*us2*us3 + 3.0*us2*us4;
   flux_west_temp_pre(2,1) = 1.732050807568877*ue1*us1 - 3.0*ue3*ue4 - 3.0*ue1*ue2 - 3.0*ue1*us2 - 3.0*ue2*us1 + 5.196152422706632*ue2*us2 + 1.732050807568877*ue3*us3 - 3.0*ue3*us4 - 3.0*ue4*us3 + 5.196152422706632*ue4*us4 + 3.0*us1*us2 + 3.0*us3*us4 - 2.598076211353316*ue1^2 + 2.598076211353316*ue2^2 - 2.598076211353316*ue3^2 + 2.598076211353316*ue4^2 - 0.8660254037844386*us1^2 - 2.598076211353316*us2^2 - 0.8660254037844386*us3^2 - 2.598076211353316*us4^2;
   flux_west_temp_pre(1,1) = 1.732050807568877*ue1*ue2 + 1.732050807568877*ue3*ue4 - 1.0*ue1*us1 + 1.732050807568877*ue1*us2 + 1.732050807568877*ue2*us1 - 3.0*ue2*us2 - 1.0*ue3*us3 + 1.732050807568877*ue3*us4 + 1.732050807568877*ue4*us3 - 3.0*ue4*us4 - 1.732050807568877*us1*us2 - 1.732050807568877*us3*us4 + 1.5*ue1^2 - 1.5*ue2^2 + 1.5*ue3^2 - 1.5*ue4^2 + 0.5*us1^2 + 1.5*us2^2 + 0.5*us3^2 + 1.5*us4^2;
   flux_west_temp =  -nuv1*flux_west_temp_pre;
   Jac_west_other_temp_pre(4,4) = 5.196152422706632*ue2 - 3.0*ue1 - 3.0*us1 + 5.196152422706632*us2;
   Jac_west_other_temp_pre(4,3) = 3.0*ue2 - 1.732050807568877*ue1 - 1.732050807568877*us1 + 3.0*us2;
   Jac_west_other_temp_pre(4,2) = 5.196152422706632*ue4 - 3.0*ue3 - 3.0*us3 + 5.196152422706632*us4;
   Jac_west_other_temp_pre(4,1) = 3.0*ue4 - 1.732050807568877*ue3 - 1.732050807568877*us3 + 3.0*us4;
   Jac_west_other_temp_pre(3,4) = 1.732050807568877*ue1 - 3.0*ue2 + 1.732050807568877*us1 - 3.0*us2;
   Jac_west_other_temp_pre(3,3) = ue1 - 1.732050807568877*ue2 + us1 - 1.732050807568877*us2;
   Jac_west_other_temp_pre(3,2) = 1.732050807568877*ue3 - 3.0*ue4 + 1.732050807568877*us3 - 3.0*us4;
   Jac_west_other_temp_pre(3,1) = ue3 - 1.732050807568877*ue4 + us3 - 1.732050807568877*us4;
   Jac_west_other_temp_pre(2,4) = 5.196152422706632*ue4 - 3.0*ue3 - 3.0*us3 + 5.196152422706632*us4;
   Jac_west_other_temp_pre(2,3) = 3.0*ue4 - 1.732050807568877*ue3 - 1.732050807568877*us3 + 3.0*us4;
   Jac_west_other_temp_pre(2,2) = 5.196152422706632*ue2 - 3.0*ue1 - 3.0*us1 + 5.196152422706632*us2;
   Jac_west_other_temp_pre(2,1) = 3.0*ue2 - 1.732050807568877*ue1 - 1.732050807568877*us1 + 3.0*us2;
   Jac_west_other_temp_pre(1,4) = 1.732050807568877*ue3 - 3.0*ue4 + 1.732050807568877*us3 - 3.0*us4;
   Jac_west_other_temp_pre(1,3) = ue3 - 1.732050807568877*ue4 + us3 - 1.732050807568877*us4;
   Jac_west_other_temp_pre(1,2) = 1.732050807568877*ue1 - 3.0*ue2 + 1.732050807568877*us1 - 3.0*us2;
   Jac_west_other_temp_pre(1,1) = ue1 - 1.732050807568877*ue2 + us1 - 1.732050807568877*us2;
   Jac_west_other_temp = -nuv1*Jac_west_other_temp_pre;
   Jac_west_cell_temp_pre(4,4) = 3.0*ue1 + 15.5884572681199*ue2 - 3.0*us1 + 5.196152422706632*us2;
   Jac_west_cell_temp_pre(4,3) = 1.732050807568877*us1 - 9.0*ue2 - 1.732050807568877*ue1 - 3.0*us2;
   Jac_west_cell_temp_pre(4,2) = 3.0*ue3 + 15.5884572681199*ue4 - 3.0*us3 + 5.196152422706632*us4;
   Jac_west_cell_temp_pre(4,1) = 1.732050807568877*us3 - 9.0*ue4 - 1.732050807568877*ue3 - 3.0*us4;
   Jac_west_cell_temp_pre(3,4) = 1.732050807568877*us1 - 9.0*ue2 - 1.732050807568877*ue1 - 3.0*us2;
   Jac_west_cell_temp_pre(3,3) = ue1 + 5.196152422706632*ue2 - 1.0*us1 + 1.732050807568877*us2;
   Jac_west_cell_temp_pre(3,2) = 1.732050807568877*us3 - 9.0*ue4 - 1.732050807568877*ue3 - 3.0*us4;
   Jac_west_cell_temp_pre(3,1) = ue3 + 5.196152422706632*ue4 - 1.0*us3 + 1.732050807568877*us4;
   Jac_west_cell_temp_pre(2,4) = 3.0*ue3 + 15.5884572681199*ue4 - 3.0*us3 + 5.196152422706632*us4;
   Jac_west_cell_temp_pre(2,3) = 1.732050807568877*us3 - 9.0*ue4 - 1.732050807568877*ue3 - 3.0*us4;
   Jac_west_cell_temp_pre(2,2) = 3.0*ue1 + 15.5884572681199*ue2 - 3.0*us1 + 5.196152422706632*us2;
   Jac_west_cell_temp_pre(2,1) = 1.732050807568877*us1 - 9.0*ue2 - 1.732050807568877*ue1 - 3.0*us2;
   Jac_west_cell_temp_pre(1,4) = 1.732050807568877*us3 - 9.0*ue4 - 1.732050807568877*ue3 - 3.0*us4;
   Jac_west_cell_temp_pre(1,3) = ue3 + 5.196152422706632*ue4 - 1.0*us3 + 1.732050807568877*us4;
   Jac_west_cell_temp_pre(1,2) = 1.732050807568877*us1 - 9.0*ue2 - 1.732050807568877*ue1 - 3.0*us2;
   Jac_west_cell_temp_pre(1,1) = ue1 + 5.196152422706632*ue2 - 1.0*us1 + 1.732050807568877*us2;
   Jac_west_cell_temp = -nuv1*Jac_west_cell_temp_pre;
else 
   flux_west_temp_pre(4,1) = 1.732050807568877*ue1*us3 - 9.0*ue1*ue4 - 9.0*ue2*ue3 - 15.5884572681199*ue2*ue4 - 5.196152422706632*ue1*ue3 + 1.732050807568877*ue3*us1 - 3.0*ue1*us4 + 3.0*ue2*us3 - 3.0*ue3*us2 + 3.0*ue4*us1 - 5.196152422706632*ue2*us4 - 5.196152422706632*ue4*us2 - 1.732050807568877*us1*us3 + 3.0*us1*us4 + 3.0*us2*us3 - 5.196152422706632*us2*us4;
   flux_west_temp_pre(3,1) = 3.0*ue1*ue3 + 5.196152422706632*ue1*ue4 + 5.196152422706632*ue2*ue3 + 9.0*ue2*ue4 - 1.0*ue1*us3 - 1.0*ue3*us1 + 1.732050807568877*ue1*us4 - 1.732050807568877*ue2*us3 + 1.732050807568877*ue3*us2 - 1.732050807568877*ue4*us1 + 3.0*ue2*us4 + 3.0*ue4*us2 + us1*us3 - 1.732050807568877*us1*us4 - 1.732050807568877*us2*us3 + 3.0*us2*us4;
   flux_west_temp_pre(2,1) = 1.732050807568877*ue1*us1 - 9.0*ue3*ue4 - 9.0*ue1*ue2 - 3.0*ue1*us2 + 3.0*ue2*us1 - 5.196152422706632*ue2*us2 + 1.732050807568877*ue3*us3 - 3.0*ue3*us4 + 3.0*ue4*us3 - 5.196152422706632*ue4*us4 + 3.0*us1*us2 + 3.0*us3*us4 - 2.598076211353316*ue1^2 - 7.794228634059948*ue2^2 - 2.598076211353316*ue3^2 - 7.794228634059948*ue4^2 - 0.8660254037844386*us1^2 - 2.598076211353316*us2^2 - 0.8660254037844386*us3^2 - 2.598076211353316*us4^2;
   flux_west_temp_pre(1,1) = 5.196152422706632*ue1*ue2 + 5.196152422706632*ue3*ue4 - 1.0*ue1*us1 + 1.732050807568877*ue1*us2 - 1.732050807568877*ue2*us1 + 3.0*ue2*us2 - 1.0*ue3*us3 + 1.732050807568877*ue3*us4 - 1.732050807568877*ue4*us3 + 3.0*ue4*us4 - 1.732050807568877*us1*us2 - 1.732050807568877*us3*us4 + 1.5*ue1^2 + 4.5*ue2^2 + 1.5*ue3^2 + 4.5*ue4^2 + 0.5*us1^2 + 1.5*us2^2 + 0.5*us3^2 + 1.5*us4^2;
   flux_west_temp =  -nuv1*flux_west_temp_pre;
   Jac_west_other_temp_pre(4,4) = - 6.0*ue1 - 10.39230484541326*ue2;
   Jac_west_other_temp_pre(4,3) = - 3.464101615137755*ue1 - 6.0*ue2;
   Jac_west_other_temp_pre(4,2) = - 6.0*ue3 - 10.39230484541326*ue4;
   Jac_west_other_temp_pre(4,1) = - 3.464101615137755*ue3 - 6.0*ue4;
   Jac_west_other_temp_pre(3,4) = 3.464101615137755*ue1 + 6.0*ue2;
   Jac_west_other_temp_pre(3,3) = 2.0*ue1 + 3.464101615137755*ue2;
   Jac_west_other_temp_pre(3,2) = 3.464101615137755*ue3 + 6.0*ue4;
   Jac_west_other_temp_pre(3,1) = 2.0*ue3 + 3.464101615137755*ue4;
   Jac_west_other_temp_pre(2,4) = - 6.0*ue3 - 10.39230484541326*ue4;
   Jac_west_other_temp_pre(2,3) = - 3.464101615137755*ue3 - 6.0*ue4;
   Jac_west_other_temp_pre(2,2) = - 6.0*ue1 - 10.39230484541326*ue2;
   Jac_west_other_temp_pre(2,1) = - 3.464101615137755*ue1 - 6.0*ue2;
   Jac_west_other_temp_pre(1,4) = 3.464101615137755*ue3 + 6.0*ue4;
   Jac_west_other_temp_pre(1,3) = 2.0*ue3 + 3.464101615137755*ue4;
   Jac_west_other_temp_pre(1,2) = 3.464101615137755*ue1 + 6.0*ue2;
   Jac_west_other_temp_pre(1,1) = 2.0*ue1 + 3.464101615137755*ue2;
   Jac_west_other_temp = -nuv1*Jac_west_other_temp_pre;
   Jac_west_cell_temp = -nuv1*Jac_west_cell_temp_pre;
end
   trunceast_temp_pre(4,1) = 3.464101615137755*us1*us3 + 6.0*us1*us4 + 6.0*us2*us3 + 10.39230484541326*us2*us4;
   trunceast_temp_pre(3,1) = 2.0*us1*us3 + 3.464101615137755*us1*us4 + 3.464101615137755*us2*us3 + 6.0*us2*us4;
   trunceast_temp_pre(2,1) = 6.0*us1*us2 + 6.0*us3*us4 + 1.732050807568877*us1^2 + 5.196152422706632*us2^2 + 1.732050807568877*us3^2 + 5.196152422706632*us4^2;
   trunceast_temp_pre(1,1) = 3.464101615137755*us1*us2 + 3.464101615137755*us3*us4 + us1^2 + 3.0*us2^2 + us3^2 + 3.0*us4^2;
   trunceast_temp = + nuv1*trunceast_temp_pre;
truncwest_temp_pre(4,1) = 6.0*us1*us4 - 3.464101615137755*us1*us3 + 6.0*us2*us3 - 10.39230484541326*us2*us4;
truncwest_temp_pre(3,1) = 2.0*us1*us3 - 3.464101615137755*us1*us4 - 3.464101615137755*us2*us3 + 6.0*us2*us4;
truncwest_temp_pre(2,1) = 6.0*us1*us2 + 6.0*us3*us4 - 1.732050807568877*us1^2 - 5.196152422706632*us2^2 - 1.732050807568877*us3^2 - 5.196152422706632*us4^2;
truncwest_temp_pre(1,1) = us1^2 - 3.464101615137755*us3*us4 - 3.464101615137755*us1*us2 + 3.0*us2^2 + us3^2 + 3.0*us4^2;
truncwest_temp = - nuv1*truncwest_temp_pre;
Jac_trunc_east_temp_pre(4,4) = 6.0*us1 + 10.39230484541326*us2;
Jac_trunc_east_temp_pre(4,3) = 3.464101615137755*us1 + 6.0*us2;
Jac_trunc_east_temp_pre(4,2) = 6.0*us3 + 10.39230484541326*us4;
Jac_trunc_east_temp_pre(4,1) = 3.464101615137755*us3 + 6.0*us4;
Jac_trunc_east_temp_pre(3,4) = 3.464101615137755*us1 + 6.0*us2;
Jac_trunc_east_temp_pre(3,3) = 2.0*us1 + 3.464101615137755*us2;
Jac_trunc_east_temp_pre(3,2) = 3.464101615137755*us3 + 6.0*us4;
Jac_trunc_east_temp_pre(3,1) = 2.0*us3 + 3.464101615137755*us4;
Jac_trunc_east_temp_pre(2,4) = 6.0*us3 + 10.39230484541326*us4;
Jac_trunc_east_temp_pre(2,3) = 3.464101615137755*us3 + 6.0*us4;
Jac_trunc_east_temp_pre(2,2) = 6.0*us1 + 10.39230484541326*us2;
Jac_trunc_east_temp_pre(2,1) = 3.464101615137755*us1 + 6.0*us2;
Jac_trunc_east_temp_pre(1,4) = 3.464101615137755*us3 + 6.0*us4;
Jac_trunc_east_temp_pre(1,3) = 2.0*us3 + 3.464101615137755*us4;
Jac_trunc_east_temp_pre(1,2) = 3.464101615137755*us1 + 6.0*us2;
Jac_trunc_east_temp_pre(1,1) = 2.0*us1 + 3.464101615137755*us2;
Jac_trunc_east_temp = nuv1*Jac_trunc_east_temp_pre;
Jac_trunc_west_temp_pre(4,4) = 6.0*us1 - 10.39230484541326*us2;
Jac_trunc_west_temp_pre(4,3) = 6.0*us2 - 3.464101615137755*us1;
Jac_trunc_west_temp_pre(4,2) = 6.0*us3 - 10.39230484541326*us4;
Jac_trunc_west_temp_pre(4,1) = 6.0*us4 - 3.464101615137755*us3;
Jac_trunc_west_temp_pre(3,4) = 6.0*us2 - 3.464101615137755*us1;
Jac_trunc_west_temp_pre(3,3) = 2.0*us1 - 3.464101615137755*us2;
Jac_trunc_west_temp_pre(3,2) = 6.0*us4 - 3.464101615137755*us3;
Jac_trunc_west_temp_pre(3,1) = 2.0*us3 - 3.464101615137755*us4;
Jac_trunc_west_temp_pre(2,4) = 6.0*us3 - 10.39230484541326*us4;
Jac_trunc_west_temp_pre(2,3) = 6.0*us4 - 3.464101615137755*us3;
Jac_trunc_west_temp_pre(2,2) = 6.0*us1 - 10.39230484541326*us2;
Jac_trunc_west_temp_pre(2,1) = 6.0*us2 - 3.464101615137755*us1;
Jac_trunc_west_temp_pre(1,4) = 6.0*us4 - 3.464101615137755*us3;
Jac_trunc_west_temp_pre(1,3) = 2.0*us3 - 3.464101615137755*us4;
Jac_trunc_west_temp_pre(1,2) = 6.0*us2 - 3.464101615137755*us1;
Jac_trunc_west_temp_pre(1,1) = 2.0*us1 - 3.464101615137755*us2;
Jac_trunc_west_temp = -nuv1*Jac_trunc_west_temp_pre;
residual_cell_pre(4,1) = 6.928203230275509*us1*us3 + 6.928203230275509*us2*us4;
residual_cell_pre(2,1) = 3.464101615137755*us1^2 + 3.464101615137755*us2^2 + 3.464101615137755*us3^2 + 3.464101615137755*us4^2;
residual_cell = - nuv1*residual_cell_pre;
Jac_cell_pre(4,4) = 6.928203230275509*us2;
Jac_cell_pre(4,3) = 6.928203230275509*us1;
Jac_cell_pre(4,2) = 6.928203230275509*us4;
Jac_cell_pre(4,1) = 6.928203230275509*us3;
Jac_cell_pre(2,4) = 6.928203230275509*us4;
Jac_cell_pre(2,3) = 6.928203230275509*us3;
Jac_cell_pre(2,2) = 6.928203230275509*us2;
Jac_cell_pre(2,1) = 6.928203230275509*us1;
Jac_cell = data.Psi_futr - nuv1*Jac_cell_pre;
