function [Jacobian,residual] = problem_region_Jacobian_residual_M1_P(q,q_past,nuv1,nuv2) 
Upsi_1_1 = q(1,1,1);
Upsi_2_1 = q(1,2,1);
Upsi_3_1 = q(1,3,1);
Upsi_4_1 = q(1,1,2);
Upsi_5_1 = q(1,2,2);
Upsi_6_1 = q(1,3,2);
Upsi_7_1 = q(1,1,3);
Upsi_8_1 = q(1,2,3);
Upsi_9_1 = q(1,3,3);
Upsi_past_1_1 = q_past(1,1,1);
Upsi_past_2_1 = q_past(1,2,1);
Upsi_past_3_1 = q_past(1,3,1);
Upsi_past_4_1 = q_past(1,1,2);
Upsi_past_5_1 = q_past(1,2,2);
Upsi_past_6_1 = q_past(1,3,2);
Upsi_past_7_1 = q_past(1,1,3);
Upsi_past_8_1 = q_past(1,2,3);
Upsi_past_9_1 = q_past(1,3,3);
Uphi1_east_1 = Upsi_1_1;
Uphi2_east_1 = Upsi_2_1;
Uphi3_east_1 = Upsi_3_1;
Uphi4_east_1 = Upsi_4_1;
Uphi5_east_1 = Upsi_5_1;
Uphi6_east_1 = Upsi_6_1;
Uphi7_east_1 = Upsi_7_1;
Uphi8_east_1 = Upsi_8_1;
Uphi9_east_1 = Upsi_9_1;
Uphi1_west_1 = Upsi_1_1;
Uphi2_west_1 = Upsi_2_1;
Uphi3_west_1 = Upsi_3_1;
Uphi4_west_1 = Upsi_4_1;
Uphi5_west_1 = Upsi_5_1;
Uphi6_west_1 = Upsi_6_1;
Uphi7_west_1 = Upsi_7_1;
Uphi8_west_1 = Upsi_8_1;
Uphi9_west_1 = Upsi_9_1;
Uphi1_nort_1 = Upsi_1_1;
Uphi2_nort_1 = Upsi_2_1;
Uphi3_nort_1 = Upsi_3_1;
Uphi4_nort_1 = Upsi_4_1;
Uphi5_nort_1 = Upsi_5_1;
Uphi6_nort_1 = Upsi_6_1;
Uphi7_nort_1 = Upsi_7_1;
Uphi8_nort_1 = Upsi_8_1;
Uphi9_nort_1 = Upsi_9_1;
Uphi1_sout_1 = Upsi_1_1;
Uphi2_sout_1 = Upsi_2_1;
Uphi3_sout_1 = Upsi_3_1;
Uphi4_sout_1 = Upsi_4_1;
Uphi5_sout_1 = Upsi_5_1;
Uphi6_sout_1 = Upsi_6_1;
Uphi7_sout_1 = Upsi_7_1;
Uphi8_sout_1 = Upsi_8_1;
Uphi9_sout_1 = Upsi_9_1;
lambda_sample_12_1_1 = max(abs(Uphi1_east_1),abs(Uphi2_west_1));
lambda_sample_23_1_1 = max(abs(Uphi2_east_1),abs(Uphi3_west_1));
lambda_sample_45_1_1 = max(abs(Uphi4_east_1),abs(Uphi5_west_1));
lambda_sample_56_1_1 = max(abs(Uphi5_east_1),abs(Uphi6_west_1));
lambda_sample_78_1_1 = max(abs(Uphi7_east_1),abs(Uphi8_west_1));
lambda_sample_89_1_1 = max(abs(Uphi8_east_1),abs(Uphi9_west_1));
lambda_sample_14_1_1 = max(abs(Uphi1_nort_1),abs(Uphi4_sout_1));
lambda_sample_25_1_1 = max(abs(Uphi2_nort_1),abs(Uphi5_sout_1));
lambda_sample_36_1_1 = max(abs(Uphi3_nort_1),abs(Uphi6_sout_1));
lambda_sample_47_1_1 = max(abs(Uphi4_nort_1),abs(Uphi7_sout_1));
lambda_sample_58_1_1 = max(abs(Uphi5_nort_1),abs(Uphi8_sout_1));
lambda_sample_69_1_1 = max(abs(Uphi6_nort_1),abs(Uphi9_sout_1));
lambda_12_1 = lambda_sample_12_1_1;
lambda_23_1 = lambda_sample_23_1_1;
lambda_45_1 = lambda_sample_45_1_1;
lambda_56_1 = lambda_sample_56_1_1;
lambda_78_1 = lambda_sample_78_1_1;
lambda_89_1 = lambda_sample_89_1_1;
lambda_14_1 = lambda_sample_14_1_1;
lambda_25_1 = lambda_sample_25_1_1;
lambda_36_1 = lambda_sample_36_1_1;
lambda_47_1 = lambda_sample_47_1_1;
lambda_58_1 = lambda_sample_58_1_1;
lambda_69_1 = lambda_sample_69_1_1;
residual = zeros(9,1);
residual(9,1) = 4.0*Upsi_9_1 - 4.0*Upsi_past_9_1 + nuv1*(2.0*Uphi9_west_1*lambda_89_1 - 2.0*Uphi8_east_1*lambda_89_1 - 1.0*Uphi8_east_1^2 + 2.0*Uphi9_east_1^2 - 1.0*Uphi9_west_1^2) + nuv2*(2.0*Uphi9_sout_1*lambda_69_1 - 2.0*Uphi6_nort_1*lambda_69_1 - 1.0*Uphi6_nort_1^2 + 2.0*Uphi9_nort_1^2 - 1.0*Uphi9_sout_1^2);
residual(8,1) = 4.0*Upsi_8_1 - 4.0*Upsi_past_8_1 + nuv1*(2.0*Uphi8_west_1*lambda_78_1 - 2.0*Uphi7_east_1*lambda_78_1 + 2.0*Uphi8_east_1*lambda_89_1 - 2.0*Uphi9_west_1*lambda_89_1 - 1.0*Uphi7_east_1^2 + Uphi8_east_1^2 - 1.0*Uphi8_west_1^2 + Uphi9_west_1^2) + nuv2*(2.0*Uphi8_sout_1*lambda_58_1 - 2.0*Uphi5_nort_1*lambda_58_1 - 1.0*Uphi5_nort_1^2 + 2.0*Uphi8_nort_1^2 - 1.0*Uphi8_sout_1^2);
residual(7,1) = 4.0*Upsi_7_1 - 4.0*Upsi_past_7_1 + nuv1*(2.0*Uphi7_east_1*lambda_78_1 - 2.0*Uphi8_west_1*lambda_78_1 + Uphi7_east_1^2 - 2.0*Uphi7_west_1^2 + Uphi8_west_1^2) + nuv2*(2.0*Uphi7_sout_1*lambda_47_1 - 2.0*Uphi4_nort_1*lambda_47_1 - 1.0*Uphi4_nort_1^2 + 2.0*Uphi7_nort_1^2 - 1.0*Uphi7_sout_1^2);
residual(6,1) = 4.0*Upsi_6_1 - 4.0*Upsi_past_6_1 + nuv1*(2.0*Uphi6_west_1*lambda_56_1 - 2.0*Uphi5_east_1*lambda_56_1 - 1.0*Uphi5_east_1^2 + 2.0*Uphi6_east_1^2 - 1.0*Uphi6_west_1^2) + nuv2*(2.0*Uphi6_sout_1*lambda_36_1 - 2.0*Uphi3_nort_1*lambda_36_1 + 2.0*Uphi6_nort_1*lambda_69_1 - 2.0*Uphi9_sout_1*lambda_69_1 - 1.0*Uphi3_nort_1^2 + Uphi6_nort_1^2 - 1.0*Uphi6_sout_1^2 + Uphi9_sout_1^2);
residual(5,1) = 4.0*Upsi_5_1 - 4.0*Upsi_past_5_1 + nuv1*(2.0*Uphi5_west_1*lambda_45_1 - 2.0*Uphi4_east_1*lambda_45_1 + 2.0*Uphi5_east_1*lambda_56_1 - 2.0*Uphi6_west_1*lambda_56_1 - 1.0*Uphi4_east_1^2 + Uphi5_east_1^2 - 1.0*Uphi5_west_1^2 + Uphi6_west_1^2) + nuv2*(2.0*Uphi5_sout_1*lambda_25_1 - 2.0*Uphi2_nort_1*lambda_25_1 + 2.0*Uphi5_nort_1*lambda_58_1 - 2.0*Uphi8_sout_1*lambda_58_1 - 1.0*Uphi2_nort_1^2 + Uphi5_nort_1^2 - 1.0*Uphi5_sout_1^2 + Uphi8_sout_1^2);
residual(4,1) = 4.0*Upsi_4_1 - 4.0*Upsi_past_4_1 + nuv1*(2.0*Uphi4_east_1*lambda_45_1 - 2.0*Uphi5_west_1*lambda_45_1 + Uphi4_east_1^2 - 2.0*Uphi4_west_1^2 + Uphi5_west_1^2) + nuv2*(2.0*Uphi4_sout_1*lambda_14_1 - 2.0*Uphi1_nort_1*lambda_14_1 + 2.0*Uphi4_nort_1*lambda_47_1 - 2.0*Uphi7_sout_1*lambda_47_1 - 1.0*Uphi1_nort_1^2 + Uphi4_nort_1^2 - 1.0*Uphi4_sout_1^2 + Uphi7_sout_1^2);
residual(3,1) = 4.0*Upsi_3_1 - 4.0*Upsi_past_3_1 + nuv1*(2.0*Uphi3_west_1*lambda_23_1 - 2.0*Uphi2_east_1*lambda_23_1 - 1.0*Uphi2_east_1^2 + 2.0*Uphi3_east_1^2 - 1.0*Uphi3_west_1^2) + nuv2*(2.0*Uphi3_nort_1*lambda_36_1 - 2.0*Uphi6_sout_1*lambda_36_1 + Uphi3_nort_1^2 - 2.0*Uphi3_sout_1^2 + Uphi6_sout_1^2);
residual(2,1) = 4.0*Upsi_2_1 - 4.0*Upsi_past_2_1 + nuv1*(2.0*Uphi2_west_1*lambda_12_1 - 2.0*Uphi1_east_1*lambda_12_1 + 2.0*Uphi2_east_1*lambda_23_1 - 2.0*Uphi3_west_1*lambda_23_1 - 1.0*Uphi1_east_1^2 + Uphi2_east_1^2 - 1.0*Uphi2_west_1^2 + Uphi3_west_1^2) + nuv2*(2.0*Uphi2_nort_1*lambda_25_1 - 2.0*Uphi5_sout_1*lambda_25_1 + Uphi2_nort_1^2 - 2.0*Uphi2_sout_1^2 + Uphi5_sout_1^2);
residual(1,1) = 4.0*Upsi_1_1 - 4.0*Upsi_past_1_1 + nuv1*(2.0*Uphi1_east_1*lambda_12_1 - 2.0*Uphi2_west_1*lambda_12_1 + Uphi1_east_1^2 - 2.0*Uphi1_west_1^2 + Uphi2_west_1^2) + nuv2*(2.0*Uphi1_nort_1*lambda_14_1 - 2.0*Uphi4_sout_1*lambda_14_1 + Uphi1_nort_1^2 - 2.0*Uphi1_sout_1^2 + Uphi4_sout_1^2);
Jacobian = zeros(9,1);
Jacobian(9,9) = 4.0 + nuv1*(4.0*Uphi9_east_1 - 2.0*Uphi9_west_1 + 2.0*lambda_89_1) + nuv2*(4.0*Uphi9_nort_1 - 2.0*Uphi9_sout_1 + 2.0*lambda_69_1);
Jacobian(9,8) =  + nuv1*(- 2.0*Uphi8_east_1 - 2.0*lambda_89_1);
Jacobian(9,6) =  + nuv2*(- 2.0*Uphi6_nort_1 - 2.0*lambda_69_1);
Jacobian(8,9) =  + nuv1*(2.0*Uphi9_west_1 - 2.0*lambda_89_1);
Jacobian(8,8) = 4.0 + nuv1*(2.0*Uphi8_east_1 - 2.0*Uphi8_west_1 + 2.0*lambda_78_1 + 2.0*lambda_89_1) + nuv2*(4.0*Uphi8_nort_1 - 2.0*Uphi8_sout_1 + 2.0*lambda_58_1);
Jacobian(8,7) =  + nuv1*(- 2.0*Uphi7_east_1 - 2.0*lambda_78_1);
Jacobian(8,5) =  + nuv2*(- 2.0*Uphi5_nort_1 - 2.0*lambda_58_1);
Jacobian(7,8) =  + nuv1*(2.0*Uphi8_west_1 - 2.0*lambda_78_1);
Jacobian(7,7) = 4.0 + nuv1*(2.0*Uphi7_east_1 - 4.0*Uphi7_west_1 + 2.0*lambda_78_1) + nuv2*(4.0*Uphi7_nort_1 - 2.0*Uphi7_sout_1 + 2.0*lambda_47_1);
Jacobian(7,4) =  + nuv2*(- 2.0*Uphi4_nort_1 - 2.0*lambda_47_1);
Jacobian(6,9) =  + nuv2*(2.0*Uphi9_sout_1 - 2.0*lambda_69_1);
Jacobian(6,6) = 4.0 + nuv1*(4.0*Uphi6_east_1 - 2.0*Uphi6_west_1 + 2.0*lambda_56_1) + nuv2*(2.0*Uphi6_nort_1 - 2.0*Uphi6_sout_1 + 2.0*lambda_36_1 + 2.0*lambda_69_1);
Jacobian(6,5) =  + nuv1*(- 2.0*Uphi5_east_1 - 2.0*lambda_56_1);
Jacobian(6,3) =  + nuv2*(- 2.0*Uphi3_nort_1 - 2.0*lambda_36_1);
Jacobian(5,8) =  + nuv2*(2.0*Uphi8_sout_1 - 2.0*lambda_58_1);
Jacobian(5,6) =  + nuv1*(2.0*Uphi6_west_1 - 2.0*lambda_56_1);
Jacobian(5,5) = 4.0 + nuv1*(2.0*Uphi5_east_1 - 2.0*Uphi5_west_1 + 2.0*lambda_45_1 + 2.0*lambda_56_1) + nuv2*(2.0*Uphi5_nort_1 - 2.0*Uphi5_sout_1 + 2.0*lambda_25_1 + 2.0*lambda_58_1);
Jacobian(5,4) =  + nuv1*(- 2.0*Uphi4_east_1 - 2.0*lambda_45_1);
Jacobian(5,2) =  + nuv2*(- 2.0*Uphi2_nort_1 - 2.0*lambda_25_1);
Jacobian(4,7) =  + nuv2*(2.0*Uphi7_sout_1 - 2.0*lambda_47_1);
Jacobian(4,5) =  + nuv1*(2.0*Uphi5_west_1 - 2.0*lambda_45_1);
Jacobian(4,4) = 4.0 + nuv1*(2.0*Uphi4_east_1 - 4.0*Uphi4_west_1 + 2.0*lambda_45_1) + nuv2*(2.0*Uphi4_nort_1 - 2.0*Uphi4_sout_1 + 2.0*lambda_14_1 + 2.0*lambda_47_1);
Jacobian(4,1) =  + nuv2*(- 2.0*Uphi1_nort_1 - 2.0*lambda_14_1);
Jacobian(3,6) =  + nuv2*(2.0*Uphi6_sout_1 - 2.0*lambda_36_1);
Jacobian(3,3) = 4.0 + nuv1*(4.0*Uphi3_east_1 - 2.0*Uphi3_west_1 + 2.0*lambda_23_1) + nuv2*(2.0*Uphi3_nort_1 - 4.0*Uphi3_sout_1 + 2.0*lambda_36_1);
Jacobian(3,2) =  + nuv1*(- 2.0*Uphi2_east_1 - 2.0*lambda_23_1);
Jacobian(2,5) =  + nuv2*(2.0*Uphi5_sout_1 - 2.0*lambda_25_1);
Jacobian(2,3) =  + nuv1*(2.0*Uphi3_west_1 - 2.0*lambda_23_1);
Jacobian(2,2) = 4.0 + nuv1*(2.0*Uphi2_east_1 - 2.0*Uphi2_west_1 + 2.0*lambda_12_1 + 2.0*lambda_23_1) + nuv2*(2.0*Uphi2_nort_1 - 4.0*Uphi2_sout_1 + 2.0*lambda_25_1);
Jacobian(2,1) =  + nuv1*(- 2.0*Uphi1_east_1 - 2.0*lambda_12_1);
Jacobian(1,4) =  + nuv2*(2.0*Uphi4_sout_1 - 2.0*lambda_14_1);
Jacobian(1,2) =  + nuv1*(2.0*Uphi2_west_1 - 2.0*lambda_12_1);
Jacobian(1,1) = 4.0 + nuv1*(2.0*Uphi1_east_1 - 4.0*Uphi1_west_1 + 2.0*lambda_12_1) + nuv2*(2.0*Uphi1_nort_1 - 4.0*Uphi1_sout_1 + 2.0*lambda_14_1);
